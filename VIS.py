# by https://blog.csdn.net/weixin_43694096
import cv2
import numpy as np

def restore_masks_to_image(mask_data, image_path, output_path):
    # 读取图像
    img = cv2.imread(image_path)
    
    # 将掩码数据还原到图像上
    for mask in mask_data:
        values = list(map(float, mask.split()))
        class_id = int(values[0])
        mask_values = values[1:]

        # 将掩码数据转换为NumPy数组
        mask_array = np.array(mask_values, dtype=np.float32).reshape((int(len(mask_values) / 2), 2))

        # 将相对于图像大小的百分比转换为具体坐标值
        mask_array[:, 0] *= img.shape[1]  # 宽度
        mask_array[:, 1] *= img.shape[0]  # 高度

        # 将坐标值转换为整数
        mask_array = mask_array.astype(np.int32)

        # 在图像上绘制掩码
        cv2.polylines(img, [mask_array], isClosed=True, color=(0, 255, 0), thickness=2)

        # 在图像上绘制每个坐标点
        for point in mask_array:
            cv2.circle(img, tuple(point), 3, (255, 0, 0), -1)  # -1 表示填充圆

    # 保存带有掩码和坐标点的图像
    cv2.imwrite(output_path, img)


if __name__ == "__main__":
    mask_data = [
        ""7.000000 0.002364 0.000000 0.002364 0.043478 0.002364 0.086957 0.002364 0.130435 0.002364 0.173913 0.002364 0.217391 0.002364 0.260870 0.002364 0.304348 0.002364 0.347826 0.000000 0.391304 0.000000 0.434783 0.000000 0.478261 0.000000 0.521739 0.000000 0.565217 0.000000 0.608696 0.000000 0.652174 0.000000 0.695652 0.002364 0.695652 0.004728 0.695652 0.007092 0.695652 0.009456 0.695652 0.011820 0.695652 0.014184 0.695652 0.016548 0.695652 0.018913 0.695652 0.021277 0.695652 0.023641 0.695652 0.026005 0.695652 0.028369 0.695652 0.030733 0.695652 0.033097 0.695652 0.035461 0.695652 0.037825 0.695652 0.040189 0.695652 0.042553 0.695652 0.044917 0.695652 0.047281 0.695652 0.049645 0.695652 0.052009 0.695652 0.054374 0.695652 0.056738 0.695652 0.059102 0.695652 0.061466 0.695652 0.063830 0.695652 0.066194 0.695652 0.068558 0.695652 0.070922 0.695652 0.073286 0.695652 0.075650 0.695652 0.078014 0.695652 0.080378 0.695652 0.082742 0.695652 0.085106 0.739130 0.087470 0.739130 0.089835 0.739130 0.092199 0.739130 0.094563 0.739130 0.096927 0.739130 0.099291 0.739130 0.101655 0.739130 0.104019 0.739130 0.106383 0.739130 0.108747 0.739130 0.111111 0.739130 0.113475 0.739130 0.115839 0.739130 0.118203 0.739130 0.120567 0.739130 0.122931 0.739130 0.125296 0.739130 0.127660 0.739130 0.130024 0.739130 0.132388 0.739130 0.134752 0.739130 0.137116 0.739130 0.139480 0.739130 0.141844 0.739130 0.144208 0.739130 0.146572 0.739130 0.148936 0.739130 0.151300 0.739130 0.153664 0.739130 0.156028 0.739130 0.158392 0.739130 0.160757 0.739130 0.163121 0.739130 0.165485 0.739130 0.167849 0.739130 0.170213 0.782609 0.172577 0.782609 0.174941 0.782609 0.177305 0.782609 0.179669 0.782609 0.182033 0.782609 0.184397 0.782609 0.186761 0.782609 0.189125 0.782609 0.191489 0.782609 0.193853 0.782609 0.196217 0.782609 0.198582 0.782609 0.200946 0.782609 0.203310 0.782609 0.205674 0.782609 0.208038 0.782609 0.210402 0.782609 0.212766 0.782609 0.215130 0.782609 0.217494 0.782609 0.219858 0.782609 0.222222 0.782609 0.224586 0.782609 0.226950 0.782609 0.229314 0.782609 0.231678 0.782609 0.234043 0.782609 0.236407 0.782609 0.238771 0.782609 0.241135 0.782609 0.243499 0.782609 0.245863 0.782609 0.248227 0.782609 0.250591 0.782609 0.252955 0.782609 0.255319 0.782609 0.257683 0.826087 0.260047 0.826087 0.262411 0.826087 0.264775 0.826087 0.267139 0.826087 0.269504 0.826087 0.271868 0.826087 0.274232 0.826087 0.276596 0.826087 0.278960 0.826087 0.281324 0.826087 0.283688 0.826087 0.286052 0.826087 0.288416 0.826087 0.290780 0.826087 0.293144 0.826087 0.295508 0.826087 0.297872 0.826087 0.300236 0.826087 0.302600 0.826087 0.304965 0.826087 0.307329 0.826087 0.309693 0.826087 0.312057 0.826087 0.314421 0.826087 0.316785 0.826087 0.319149 0.826087 0.321513 0.826087 0.323877 0.826087 0.326241 0.826087 0.328605 0.826087 0.330969 0.826087 0.333333 0.826087 0.335697 0.826087 0.338061 0.826087 0.340426 0.826087 0.342790 0.869565 0.345154 0.869565 0.347518 0.869565 0.349882 0.869565 0.352246 0.869565 0.354610 0.869565 0.356974 0.869565 0.359338 0.869565 0.361702 0.869565 0.364066 0.869565 0.366430 0.869565 0.368794 0.869565 0.371158 0.869565 0.373522 0.869565 0.375887 0.869565 0.378251 0.869565 0.380615 0.869565 0.382979 0.869565 0.385343 0.869565 0.387707 0.869565 0.390071 0.869565 0.392435 0.869565 0.394799 0.869565 0.397163 0.869565 0.399527 0.869565 0.401891 0.869565 0.404255 0.869565 0.406619 0.869565 0.408983 0.869565 0.411348 0.869565 0.413712 0.869565 0.416076 0.869565 0.418440 0.869565 0.420804 0.869565 0.423168 0.869565 0.425532 0.869565 0.427896 0.913043 0.430260 0.913043 0.432624 0.913043 0.434988 0.913043 0.437352 0.913043 0.439716 0.913043 0.442080 0.913043 0.444444 0.913043 0.446809 0.913043 0.449173 0.913043 0.451537 0.913043 0.453901 0.913043 0.456265 0.913043 0.458629 0.913043 0.460993 0.913043 0.463357 0.913043 0.465721 0.913043 0.468085 0.913043 0.470449 0.913043 0.472813 0.913043 0.475177 0.913043 0.477541 0.913043 0.479905 0.913043 0.482270 0.913043 0.484634 0.913043 0.486998 0.913043 0.489362 0.913043 0.491726 0.913043 0.494090 0.913043 0.496454 0.913043 0.498818 0.913043 0.501182 0.913043 0.503546 0.913043 0.505910 0.913043 0.508274 0.913043 0.510638 0.913043 0.513002 0.956522 0.515366 0.956522 0.517730 0.956522 0.520095 0.956522 0.522459 0.956522 0.524823 0.956522 0.527187 0.956522 0.529551 0.956522 0.531915 0.956522 0.534279 0.956522 0.536643 0.956522 0.539007 0.956522 0.541371 0.956522 0.543735 0.956522 0.546099 0.956522 0.548463 0.956522 0.550827 0.956522 0.553191 0.956522 0.555556 0.956522 0.557920 0.956522 0.560284 0.956522 0.562648 0.956522 0.565012 0.956522 0.567376 0.956522 0.569740 0.956522 0.572104 0.956522 0.574468 0.956522 0.576832 0.956522 0.579196 0.956522 0.581560 0.956522 0.583924 0.956522 0.586288 0.956522 0.588652 0.956522 0.591017 0.956522 0.593381 0.956522 0.595745 0.956522 0.598109 0.956522 0.600473 0.956522 0.602837 0.956522 0.605201 0.956522 0.607565 0.956522 0.609929 0.956522 0.612293 0.956522 0.614657 0.956522 0.617021 0.956522 0.619385 0.956522 0.621749 0.956522 0.624113 0.956522 0.626478 0.956522 0.628842 0.956522 0.631206 0.956522 0.633570 0.956522 0.635934 0.956522 0.638298 0.956522 0.640662 0.956522 0.643026 0.956522 0.645390 0.956522 0.647754 0.956522 0.650118 0.956522 0.652482 0.956522 0.654846 0.956522 0.657210 0.956522 0.659574 0.956522 0.661939 0.956522 0.664303 0.956522 0.666667 0.956522 0.669031 0.956522 0.671395 0.956522 0.673759 0.956522 0.676123 0.956522 0.678487 0.956522 0.680851 0.956522 0.683215 0.956522 0.685579 0.956522 0.687943 0.956522 0.690307 0.956522 0.692671 0.956522 0.695035 0.956522 0.697400 0.956522 0.699764 0.956522 0.702128 0.956522 0.704492 0.956522 0.706856 0.956522 0.709220 0.956522 0.711584 0.956522 0.713948 0.956522 0.716312 0.956522 0.718676 0.956522 0.721040 0.956522 0.723404 0.956522 0.725768 0.956522 0.728132 0.956522 0.730496 0.956522 0.732861 0.956522 0.735225 0.956522 0.737589 0.956522 0.739953 0.956522 0.742317 0.956522 0.744681 0.956522 0.747045 0.956522 0.749409 0.956522 0.751773 0.956522 0.754137 0.956522 0.756501 0.956522 0.758865 0.956522 0.761229 0.956522 0.763593 0.956522 0.765957 0.956522 0.768322 0.956522 0.770686 0.956522 0.773050 0.956522 0.775414 0.956522 0.777778 0.956522 0.780142 0.956522 0.782506 0.956522 0.784870 0.956522 0.787234 0.956522 0.789598 0.956522 0.791962 0.956522 0.794326 0.956522 0.796690 0.956522 0.799054 0.956522 0.801418 0.956522 0.803783 0.956522 0.806147 0.956522 0.808511 0.956522 0.810875 0.956522 0.813239 0.956522 0.815603 0.956522 0.817967 0.956522 0.820331 0.956522 0.822695 0.956522 0.825059 0.956522 0.827423 0.956522 0.829787 0.956522 0.832151 0.956522 0.834515 0.956522 0.836879 0.956522 0.839243 0.956522 0.841608 0.956522 0.843972 0.956522 0.846336 0.956522 0.848700 0.956522 0.851064 0.956522 0.853428 0.956522 0.855792 0.956522 0.858156 0.956522 0.860520 0.956522 0.862884 0.956522 0.865248 0.956522 0.867612 0.956522 0.869976 0.956522 0.872340 0.956522 0.874704 0.956522 0.877069 0.956522 0.879433 0.956522 0.881797 0.956522 0.884161 0.956522 0.886525 0.956522 0.888889 0.956522 0.891253 0.956522 0.893617 0.956522 0.895981 0.956522 0.898345 0.956522 0.900709 0.956522 0.903073 0.956522 0.905437 0.956522 0.907801 0.956522 0.910165 0.956522 0.912530 0.956522 0.914894 0.956522 0.917258 0.956522 0.919622 0.956522 0.921986 0.956522 0.924350 0.956522 0.926714 0.956522 0.929078 0.956522 0.931442 0.956522 0.933806 0.956522 0.936170 0.956522 0.938534 0.956522 0.940898 0.956522 0.943262 0.956522 0.945626 0.956522 0.947991 0.956522 0.950355 0.956522 0.952719 0.956522 0.955083 0.956522 0.957447 0.956522 0.959811 0.956522 0.962175 0.913043 0.964539 0.913043 0.966903 0.869565 0.969267 0.869565 0.971631 0.869565 0.973995 0.826087 0.976359 0.826087 0.978723 0.782609 0.981087 0.782609 0.983452 0.782609 0.985816 0.739130 0.988180 0.739130 0.990544 0.739130 0.992908 0.695652 0.995272 0.695652 0.997636 0.695652 0.997636 0.652174 0.997636 0.608696 0.997636 0.565217 0.997636 0.521739 0.997636 0.478261 0.997636 0.434783 0.997636 0.391304 0.997636 0.347826 0.997636 0.304348 0.995272 0.304348 0.992908 0.304348 0.990544 0.304348 0.988180 0.304348 0.985816 0.260870 0.983452 0.260870 0.981087 0.260870 0.978723 0.260870 0.976359 0.260870 0.973995 0.217391 0.971631 0.217391 0.969267 0.217391 0.966903 0.217391 0.964539 0.217391 0.962175 0.173913 0.959811 0.130435 0.959811 0.086957 0.957447 0.086957 0.955083 0.086957 0.952719 0.086957 0.950355 0.086957 0.947991 0.086957 0.945626 0.086957 0.943262 0.086957 0.940898 0.086957 0.938534 0.086957 0.936170 0.086957 0.933806 0.086957 0.931442 0.086957 0.929078 0.086957 0.926714 0.086957 0.924350 0.086957 0.921986 0.086957 0.919622 0.086957 0.917258 0.086957 0.914894 0.086957 0.912530 0.086957 0.910165 0.086957 0.907801 0.086957 0.905437 0.086957 0.903073 0.086957 0.900709 0.086957 0.898345 0.086957 0.895981 0.086957 0.893617 0.086957 0.891253 0.086957 0.888889 0.086957 0.886525 0.086957 0.884161 0.086957 0.881797 0.086957 0.879433 0.086957 0.877069 0.086957 0.874704 0.086957 0.872340 0.086957 0.869976 0.086957 0.867612 0.086957 0.865248 0.086957 0.862884 0.086957 0.860520 0.086957 0.858156 0.086957 0.855792 0.086957 0.853428 0.086957 0.851064 0.086957 0.848700 0.086957 0.846336 0.086957 0.843972 0.086957 0.841608 0.086957 0.839243 0.086957 0.836879 0.086957 0.834515 0.086957 0.832151 0.086957 0.829787 0.086957 0.827423 0.086957 0.825059 0.086957 0.822695 0.086957 0.820331 0.086957 0.817967 0.086957 0.815603 0.086957 0.813239 0.086957 0.810875 0.086957 0.808511 0.086957 0.806147 0.086957 0.803783 0.086957 0.801418 0.086957 0.799054 0.086957 0.796690 0.086957 0.794326 0.086957 0.791962 0.086957 0.789598 0.086957 0.787234 0.086957 0.784870 0.086957 0.782506 0.086957 0.780142 0.086957 0.777778 0.086957 0.775414 0.086957 0.773050 0.086957 0.770686 0.086957 0.768322 0.086957 0.765957 0.086957 0.763593 0.086957 0.761229 0.086957 0.758865 0.086957 0.756501 0.086957 0.754137 0.086957 0.751773 0.086957 0.749409 0.086957 0.747045 0.086957 0.744681 0.086957 0.742317 0.086957 0.739953 0.086957 0.737589 0.086957 0.735225 0.086957 0.732861 0.086957 0.730496 0.086957 0.728132 0.086957 0.725768 0.086957 0.723404 0.086957 0.721040 0.086957 0.718676 0.086957 0.716312 0.086957 0.713948 0.086957 0.711584 0.086957 0.709220 0.086957 0.706856 0.086957 0.704492 0.086957 0.702128 0.086957 0.699764 0.086957 0.697400 0.086957 0.695035 0.086957 0.692671 0.086957 0.690307 0.086957 0.687943 0.086957 0.685579 0.086957 0.683215 0.086957 0.680851 0.086957 0.678487 0.086957 0.676123 0.086957 0.673759 0.086957 0.671395 0.086957 0.669031 0.086957 0.666667 0.086957 0.664303 0.086957 0.661939 0.086957 0.659574 0.086957 0.657210 0.086957 0.654846 0.086957 0.652482 0.086957 0.650118 0.086957 0.647754 0.086957 0.645390 0.086957 0.643026 0.086957 0.640662 0.086957 0.638298 0.086957 0.635934 0.086957 0.633570 0.043478 0.631206 0.043478 0.628842 0.043478 0.626478 0.043478 0.624113 0.043478 0.621749 0.043478 0.619385 0.043478 0.617021 0.043478 0.614657 0.043478 0.612293 0.043478 0.609929 0.043478 0.607565 0.043478 0.605201 0.043478 0.602837 0.043478 0.600473 0.043478 0.598109 0.043478 0.595745 0.043478 0.593381 0.043478 0.591017 0.043478 0.588652 0.043478 0.586288 0.043478 0.583924 0.043478 0.581560 0.043478 0.579196 0.043478 0.576832 0.043478 0.574468 0.043478 0.572104 0.043478 0.569740 0.043478 0.567376 0.043478 0.565012 0.043478 0.562648 0.043478 0.560284 0.043478 0.557920 0.043478 0.555556 0.043478 0.553191 0.043478 0.550827 0.043478 0.548463 0.043478 0.546099 0.043478 0.543735 0.043478 0.541371 0.043478 0.539007 0.043478 0.536643 0.043478 0.534279 0.043478 0.531915 0.043478 0.529551 0.043478 0.527187 0.043478 0.524823 0.043478 0.522459 0.043478 0.520095 0.043478 0.517730 0.043478 0.515366 0.043478 0.513002 0.043478 0.510638 0.043478 0.508274 0.043478 0.505910 0.043478 0.503546 0.043478 0.501182 0.043478 0.498818 0.043478 0.496454 0.043478 0.494090 0.043478 0.491726 0.043478 0.489362 0.043478 0.486998 0.043478 0.484634 0.043478 0.482270 0.043478 0.479905 0.043478 0.477541 0.043478 0.475177 0.043478 0.472813 0.043478 0.470449 0.043478 0.468085 0.043478 0.465721 0.043478 0.463357 0.043478 0.460993 0.043478 0.458629 0.043478 0.456265 0.043478 0.453901 0.043478 0.451537 0.043478 0.449173 0.043478 0.446809 0.043478 0.444444 0.043478 0.442080 0.043478 0.439716 0.043478 0.437352 0.043478 0.434988 0.043478 0.432624 0.043478 0.430260 0.043478 0.427896 0.043478 0.425532 0.043478 0.423168 0.043478 0.420804 0.043478 0.418440 0.043478 0.416076 0.043478 0.413712 0.043478 0.411348 0.043478 0.408983 0.043478 0.406619 0.043478 0.404255 0.043478 0.401891 0.043478 0.399527 0.043478 0.397163 0.043478 0.394799 0.043478 0.392435 0.043478 0.390071 0.043478 0.387707 0.043478 0.385343 0.043478 0.382979 0.043478 0.380615 0.043478 0.378251 0.043478 0.375887 0.043478 0.373522 0.043478 0.371158 0.043478 0.368794 0.043478 0.366430 0.043478 0.364066 0.043478 0.361702 0.043478 0.359338 0.043478 0.356974 0.043478 0.354610 0.043478 0.352246 0.043478 0.349882 0.043478 0.347518 0.043478 0.345154 0.043478 0.342790 0.043478 0.340426 0.043478 0.338061 0.043478 0.335697 0.043478 0.333333 0.043478 0.330969 0.043478 0.328605 0.043478 0.326241 0.043478 0.323877 0.043478 0.321513 0.043478 0.319149 0.043478 0.316785 0.043478 0.314421 0.043478 0.312057 0.043478 0.309693 0.043478 0.307329 0.043478 0.304965 0.043478 0.302600 0.043478 0.300236 0.043478 0.297872 0.043478 0.295508 0.043478 0.293144 0.043478 0.290780 0.043478 0.288416 0.043478 0.286052 0.043478 0.283688 0.043478 0.281324 0.043478 0.278960 0.043478 0.276596 0.043478 0.274232 0.043478 0.271868 0.043478 0.269504 0.043478 0.267139 0.043478 0.264775 0.043478 0.262411 0.043478 0.260047 0.043478 0.257683 0.043478 0.255319 0.043478 0.252955 0.043478 0.250591 0.043478 0.248227 0.043478 0.245863 0.043478 0.243499 0.043478 0.241135 0.043478 0.238771 0.043478 0.236407 0.043478 0.234043 0.043478 0.231678 0.043478 0.229314 0.043478 0.226950 0.043478 0.224586 0.043478 0.222222 0.043478 0.219858 0.043478 0.217494 0.043478 0.215130 0.043478 0.212766 0.043478 0.210402 0.043478 0.208038 0.043478 0.205674 0.043478 0.203310 0.043478 0.200946 0.043478 0.198582 0.043478 0.196217 0.043478 0.193853 0.043478 0.191489 0.043478 0.189125 0.043478 0.186761 0.043478 0.184397 0.043478 0.182033 0.043478 0.179669 0.043478 0.177305 0.043478 0.174941 0.043478 0.172577 0.043478 0.170213 0.043478 0.167849 0.043478 0.165485 0.043478 0.163121 0.043478 0.160757 0.043478 0.158392 0.043478 0.156028 0.043478 0.153664 0.043478 0.151300 0.043478 0.148936 0.043478 0.146572 0.043478 0.144208 0.043478 0.141844 0.043478 0.139480 0.043478 0.137116 0.043478 0.134752 0.043478 0.132388 0.043478 0.130024 0.043478 0.127660 0.043478 0.125296 0.043478 0.122931 0.043478 0.120567 0.043478 0.118203 0.043478 0.115839 0.043478 0.113475 0.043478 0.111111 0.043478 0.108747 0.043478 0.106383 0.043478 0.104019 0.043478 0.101655 0.043478 0.099291 0.043478 0.096927 0.043478 0.094563 0.043478 0.092199 0.043478 0.089835 0.043478 0.087470 0.043478 0.085106 0.043478 0.082742 0.043478 0.080378 0.043478 0.078014 0.043478 0.075650 0.043478 0.073286 0.043478 0.070922 0.043478 0.068558 0.043478 0.066194 0.043478 0.063830 0.043478 0.061466 0.043478 0.059102 0.043478 0.056738 0.043478 0.054374 0.043478 0.052009 0.043478 0.049645 0.043478 0.047281 0.043478 0.044917 0.043478 0.042553 0.043478 0.040189 0.043478 0.037825 0.043478 0.035461 0.043478 0.033097 0.043478 0.030733 0.043478 0.028369 0.043478 0.026005 0.043478 0.023641 0.043478 0.021277 0.043478 0.018913 0.043478 0.016548 0.043478 0.014184 0.043478 0.011820 0.043478 0.009456 0.043478 0.007092 0.043478 0.004728 0.043478
]

    image_path = "/root/yolov8/ultralytics/datasets/iSAID/testset/P0001.png"
    output_path = "/root/yolov8/ultralytics/datasets/iSAID/testset/P0001_out.png"

    restore_masks_to_image(mask_data, image_path, output_path)


